{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Hooks = void 0;\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\nvar _react = _interopRequireDefault(require(\"react\"));\nvar _Shared = require(\"../../../Shared\");\nvar _ = require(\"../../\");\nvar _unsafeContent = _interopRequireDefault(require(\"./resources/unsafe-content.svg\"));\nvar Hooks = function Hooks(props, setImageURL, imageURL, setUnsafe, setOverlayImage) {\n  var errorHandler = function errorHandler(errorCode) {\n    _.CometChatMessageEvents.emit(_.CometChatMessageEvents.onMessageError, errorCode);\n  };\n  var pickImage = function pickImage(thumbnailGenerationObject) {\n    var smallUrl = thumbnailGenerationObject[\"url_small\"];\n    var mediumUrl = thumbnailGenerationObject[\"url_medium\"];\n    var mq = window.matchMedia(\"(min-width: 320px) and (max-width: 767px)\");\n    var imageToDownload = mediumUrl;\n    if (mq.matches) {\n      imageToDownload = smallUrl;\n    }\n    return imageToDownload;\n  };\n  _react.default.useEffect(function () {\n    if (props && props.overlayImageURL) {\n      setOverlayImage(props.overlayImageURL);\n    } else {\n      setOverlayImage(_unsafeContent.default);\n    }\n  }, [props, props.overlayImageURL]);\n  var downloadImage = function downloadImage(imgUrl) {\n    return new Promise(function (resolve, reject) {\n      var timer;\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", imgUrl, true);\n      xhr.responseType = \"blob\";\n      xhr.onload = function () {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) {\n            timer = null;\n            resolve(imgUrl);\n          } else if (xhr.status === 403) {\n            timer = setTimeout(function () {\n              downloadImage(imgUrl).then(function (response) {\n                return resolve(imgUrl);\n              }).catch(function (error) {\n                return reject(error);\n              });\n            }, 800);\n          }\n        } else {\n          reject(xhr.statusText);\n        }\n      };\n      xhr.onerror = function (event) {\n        return reject(new Error(\"There was a network error.\", event));\n      };\n      xhr.ontimeout = function (event) {\n        return reject(new Error(\"There was a timeout error.\", event));\n      };\n      xhr.send();\n    });\n  };\n  var setMessageImageUrl = _react.default.useCallback(function () {\n    return new Promise(function (resolve) {\n      var img = new Image();\n      if (props.messageObject && props.messageObject.data && props.messageObject.data.attachments && (0, _typeof2.default)(props.messageObject.data.attachments) === \"object\" && props.messageObject.data.attachments.length) {\n        var _props$messageObject$;\n        img.src = (_props$messageObject$ = props.messageObject.data.attachments[0]) === null || _props$messageObject$ === void 0 ? void 0 : _props$messageObject$.url;\n      } else if (props.messageObject.data.file && props.messageObject.data.file) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          img.src = reader.result;\n        };\n        reader.readAsDataURL(props.messageObject.data.file);\n      }\n      img.onload = function () {\n        return resolve(img.src);\n      };\n    });\n  }, [props.messageObject]);\n  _react.default.useEffect(function () {\n    if (props.imageURL && props.imageURL.length) {\n      setImageURL(props.imageURL);\n    } else if (props.messageObject) {\n      var thumbnailGenerationExtensionData = (0, _Shared.getExtensionsData)(props.messageObject, _Shared.MetadataConstants.extensions.thumbnailGeneration);\n      if (thumbnailGenerationExtensionData && !thumbnailGenerationExtensionData.hasOwnProperty(\"error\")) {\n        var imageToDownload = pickImage(thumbnailGenerationExtensionData);\n        downloadImage(imageToDownload).then(function (response) {\n          var img = new Image();\n          img.src = imageToDownload;\n          img.onload = function () {\n            return setImageURL(img.src);\n          };\n        }).catch(function (error) {\n          errorHandler(error);\n          console.error(error);\n        });\n      } else {\n        setMessageImageUrl().then(function (imageUrl) {\n          if (imageUrl !== imageURL) {\n            setImageURL(imageUrl);\n          }\n        });\n      }\n    }\n  }, [imageURL, props.imageURL, props.messageObject, setImageURL, setMessageImageUrl]);\n  _react.default.useEffect(function () {\n    var imageModeration = (0, _Shared.getExtensionsData)(props === null || props === void 0 ? void 0 : props.messageObject, \"image-moderation\");\n    if ((imageModeration === null || imageModeration === void 0 ? void 0 : imageModeration[\"unsafe\"]) === \"yes\") {\n      setUnsafe(true);\n    } else {\n      setUnsafe(false);\n    }\n  }, [props.messageObject]);\n};\nexports.Hooks = Hooks;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","Hooks","_typeof2","_react","_Shared","_","_unsafeContent","props","setImageURL","imageURL","setUnsafe","setOverlayImage","errorHandler","errorCode","CometChatMessageEvents","emit","onMessageError","pickImage","thumbnailGenerationObject","smallUrl","mediumUrl","mq","window","matchMedia","imageToDownload","matches","default","useEffect","overlayImageURL","downloadImage","imgUrl","Promise","resolve","reject","timer","xhr","XMLHttpRequest","open","responseType","onload","readyState","status","setTimeout","then","response","catch","error","statusText","onerror","event","Error","ontimeout","send","setMessageImageUrl","useCallback","img","Image","messageObject","data","attachments","length","_props$messageObject$","src","url","file","reader","FileReader","result","readAsDataURL","thumbnailGenerationExtensionData","getExtensionsData","MetadataConstants","extensions","thumbnailGeneration","hasOwnProperty","console","imageUrl","imageModeration"],"sources":["/home/admin1/dev/react/react-sample-guide/sample-react-guides/node_modules/cometchat-react-ui-kit/dist/Messages/Bubbles/CometChatImageBubble/hooks.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Hooks = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _Shared = require(\"../../../Shared\");\n\nvar _ = require(\"../../\");\n\nvar _unsafeContent = _interopRequireDefault(require(\"./resources/unsafe-content.svg\"));\n\nvar Hooks = function Hooks(props, setImageURL, imageURL, setUnsafe, setOverlayImage) {\n  var errorHandler = function errorHandler(errorCode) {\n    _.CometChatMessageEvents.emit(_.CometChatMessageEvents.onMessageError, errorCode);\n  };\n\n  var pickImage = function pickImage(thumbnailGenerationObject) {\n    var smallUrl = thumbnailGenerationObject[\"url_small\"];\n    var mediumUrl = thumbnailGenerationObject[\"url_medium\"];\n    var mq = window.matchMedia(\"(min-width: 320px) and (max-width: 767px)\");\n    var imageToDownload = mediumUrl;\n\n    if (mq.matches) {\n      imageToDownload = smallUrl;\n    }\n\n    return imageToDownload;\n  };\n\n  _react.default.useEffect(function () {\n    if (props && props.overlayImageURL) {\n      setOverlayImage(props.overlayImageURL);\n    } else {\n      setOverlayImage(_unsafeContent.default);\n    }\n  }, [props, props.overlayImageURL]);\n\n  var downloadImage = function downloadImage(imgUrl) {\n    return new Promise(function (resolve, reject) {\n      var timer;\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", imgUrl, true);\n      xhr.responseType = \"blob\";\n\n      xhr.onload = function () {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) {\n            timer = null;\n            resolve(imgUrl);\n          } else if (xhr.status === 403) {\n            timer = setTimeout(function () {\n              downloadImage(imgUrl).then(function (response) {\n                return resolve(imgUrl);\n              }).catch(function (error) {\n                return reject(error);\n              });\n            }, 800);\n          }\n        } else {\n          reject(xhr.statusText);\n        }\n      };\n\n      xhr.onerror = function (event) {\n        return reject(new Error(\"There was a network error.\", event));\n      };\n\n      xhr.ontimeout = function (event) {\n        return reject(new Error(\"There was a timeout error.\", event));\n      };\n\n      xhr.send();\n    });\n  };\n\n  var setMessageImageUrl = _react.default.useCallback(function () {\n    return new Promise(function (resolve) {\n      var img = new Image();\n\n      if (props.messageObject && props.messageObject.data && props.messageObject.data.attachments && (0, _typeof2.default)(props.messageObject.data.attachments) === \"object\" && props.messageObject.data.attachments.length) {\n        var _props$messageObject$;\n\n        img.src = (_props$messageObject$ = props.messageObject.data.attachments[0]) === null || _props$messageObject$ === void 0 ? void 0 : _props$messageObject$.url;\n      } else if (props.messageObject.data.file && props.messageObject.data.file) {\n        var reader = new FileReader();\n\n        reader.onload = function () {\n          img.src = reader.result;\n        };\n\n        reader.readAsDataURL(props.messageObject.data.file);\n      }\n\n      img.onload = function () {\n        return resolve(img.src);\n      };\n    });\n  }, [props.messageObject]);\n\n  _react.default.useEffect(function () {\n    if (props.imageURL && props.imageURL.length) {\n      setImageURL(props.imageURL);\n    } else if (props.messageObject) {\n      var thumbnailGenerationExtensionData = (0, _Shared.getExtensionsData)(props.messageObject, _Shared.MetadataConstants.extensions.thumbnailGeneration);\n\n      if (thumbnailGenerationExtensionData && !thumbnailGenerationExtensionData.hasOwnProperty(\"error\")) {\n        var imageToDownload = pickImage(thumbnailGenerationExtensionData);\n        downloadImage(imageToDownload).then(function (response) {\n          var img = new Image();\n          img.src = imageToDownload;\n\n          img.onload = function () {\n            return setImageURL(img.src);\n          };\n        }).catch(function (error) {\n          errorHandler(error);\n          console.error(error);\n        });\n      } else {\n        setMessageImageUrl().then(function (imageUrl) {\n          if (imageUrl !== imageURL) {\n            setImageURL(imageUrl);\n          }\n        });\n      }\n    }\n  }, [imageURL, props.imageURL, props.messageObject, setImageURL, setMessageImageUrl]);\n\n  _react.default.useEffect(function () {\n    var imageModeration = (0, _Shared.getExtensionsData)(props === null || props === void 0 ? void 0 : props.messageObject, \"image-moderation\");\n\n    if ((imageModeration === null || imageModeration === void 0 ? void 0 : imageModeration[\"unsafe\"]) === \"yes\") {\n      setUnsafe(true);\n    } else {\n      setUnsafe(false);\n    }\n  }, [props.messageObject]);\n};\n\nexports.Hooks = Hooks;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}