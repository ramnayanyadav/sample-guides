{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Hooks = void 0;\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\nvar _react = _interopRequireDefault(require(\"react\"));\nvar _Shared = require(\"../../../Shared\");\nvar _ = require(\"../../\");\nvar Hooks = function Hooks(props, setImageURL, imageURL, setUnsafe) {\n  var pickImage = function pickImage(thumbnailGenerationObject) {\n    var mediumUrl = thumbnailGenerationObject[\"url_medium\"];\n    return mediumUrl;\n  };\n  var downloadImage = function downloadImage(imgUrl) {\n    return new Promise(function (resolve, reject) {\n      var timer;\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", imgUrl, true);\n      xhr.responseType = \"blob\";\n      xhr.onload = function () {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) {\n            timer = null;\n            resolve(imgUrl);\n          } else if (xhr.status === 403) {\n            timer = setTimeout(function () {\n              downloadImage(imgUrl).then(function (response) {\n                return resolve(imgUrl);\n              })[\"catch\"](function (error) {\n                return reject(error);\n              });\n            }, 800);\n          }\n        } else {\n          reject(xhr.statusText);\n        }\n      };\n      xhr.onerror = function (event) {\n        return reject(new Error(\"There was a network error.\", event));\n      };\n      xhr.ontimeout = function (event) {\n        return reject(new Error(\"There was a timeout error.\", event));\n      };\n      xhr.send();\n    });\n  };\n  var setMessageImageUrl = _react[\"default\"].useCallback(function () {\n    return new Promise(function (resolve) {\n      var img = new Image();\n      if (props.messageObject && props.messageObject.data && props.messageObject.data.attachments && (0, _typeof2[\"default\"])(props.messageObject.data.attachments) === \"object\" && props.messageObject.data.attachments.length) {\n        var _props$messageObject$;\n        img.src = (_props$messageObject$ = props.messageObject.data.attachments[0]) === null || _props$messageObject$ === void 0 ? void 0 : _props$messageObject$.url;\n      } else if (props.messageObject.data.file && props.messageObject.data.file) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          img.src = reader.result;\n        };\n        reader.readAsDataURL(props.messageObject.data.file);\n      }\n      img.onload = function () {\n        return resolve(img.src);\n      };\n    });\n  }, [props.messageObject]);\n  _react[\"default\"].useEffect(function () {\n    if (props.imageURL && props.imageURL.length) {\n      setImageURL(props.imageURL);\n    } else if (props.messageObject) {\n      var thumbnailGenerationExtensionData = (0, _Shared.getExtensionsData)(props.messageObject, _Shared.MetadataConstants.extensions.thumbnailGeneration);\n      if (thumbnailGenerationExtensionData && !thumbnailGenerationExtensionData.hasOwnProperty(\"error\")) {\n        var imageToDownload = pickImage(thumbnailGenerationExtensionData);\n        downloadImage(imageToDownload).then(function (response) {\n          var img = new Image();\n          img.src = imageToDownload;\n          img.onload = function () {\n            return setImageURL(img.src);\n          };\n        })[\"catch\"](function (error) {\n          _.CometChatMessageEvents.emit(_.CometChatMessageEvents.onMessageError, error);\n        });\n      } else {\n        setMessageImageUrl().then(function (imageUrl) {\n          if (imageUrl !== imageURL) {\n            setImageURL(imageUrl);\n          }\n        });\n      }\n    }\n\n    /**image moderation extension */\n    var imageModeration = (0, _Shared.getExtensionsData)(props === null || props === void 0 ? void 0 : props.messageObject, _Shared.ExtensionConstants.imageModeration);\n    if ((imageModeration === null || imageModeration === void 0 ? void 0 : imageModeration[\"unsafe\"]) === \"yes\") {\n      setUnsafe(true);\n    } else {\n      setUnsafe(false);\n    }\n  }, [props, imageURL, props.imageURL, props.messageObject, setImageURL, setMessageImageUrl]);\n};\nexports.Hooks = Hooks;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","Hooks","_typeof2","_react","_Shared","_","props","setImageURL","imageURL","setUnsafe","pickImage","thumbnailGenerationObject","mediumUrl","downloadImage","imgUrl","Promise","resolve","reject","timer","xhr","XMLHttpRequest","open","responseType","onload","readyState","status","setTimeout","then","response","error","statusText","onerror","event","Error","ontimeout","send","setMessageImageUrl","useCallback","img","Image","messageObject","data","attachments","length","_props$messageObject$","src","url","file","reader","FileReader","result","readAsDataURL","useEffect","thumbnailGenerationExtensionData","getExtensionsData","MetadataConstants","extensions","thumbnailGeneration","hasOwnProperty","imageToDownload","CometChatMessageEvents","emit","onMessageError","imageUrl","imageModeration","ExtensionConstants"],"sources":["/home/admin1/dev/react/sample-react-guides/node_modules/@cometchat-pro/react-ui-kit/dist/Messages/Bubbles/CometChatImageBubble/hooks.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Hooks = void 0;\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\nvar _react = _interopRequireDefault(require(\"react\"));\nvar _Shared = require(\"../../../Shared\");\nvar _ = require(\"../../\");\nvar Hooks = function Hooks(props, setImageURL, imageURL, setUnsafe) {\n  var pickImage = function pickImage(thumbnailGenerationObject) {\n    var mediumUrl = thumbnailGenerationObject[\"url_medium\"];\n    return mediumUrl;\n  };\n  var downloadImage = function downloadImage(imgUrl) {\n    return new Promise(function (resolve, reject) {\n      var timer;\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", imgUrl, true);\n      xhr.responseType = \"blob\";\n      xhr.onload = function () {\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) {\n            timer = null;\n            resolve(imgUrl);\n          } else if (xhr.status === 403) {\n            timer = setTimeout(function () {\n              downloadImage(imgUrl).then(function (response) {\n                return resolve(imgUrl);\n              })[\"catch\"](function (error) {\n                return reject(error);\n              });\n            }, 800);\n          }\n        } else {\n          reject(xhr.statusText);\n        }\n      };\n      xhr.onerror = function (event) {\n        return reject(new Error(\"There was a network error.\", event));\n      };\n      xhr.ontimeout = function (event) {\n        return reject(new Error(\"There was a timeout error.\", event));\n      };\n      xhr.send();\n    });\n  };\n  var setMessageImageUrl = _react[\"default\"].useCallback(function () {\n    return new Promise(function (resolve) {\n      var img = new Image();\n      if (props.messageObject && props.messageObject.data && props.messageObject.data.attachments && (0, _typeof2[\"default\"])(props.messageObject.data.attachments) === \"object\" && props.messageObject.data.attachments.length) {\n        var _props$messageObject$;\n        img.src = (_props$messageObject$ = props.messageObject.data.attachments[0]) === null || _props$messageObject$ === void 0 ? void 0 : _props$messageObject$.url;\n      } else if (props.messageObject.data.file && props.messageObject.data.file) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          img.src = reader.result;\n        };\n        reader.readAsDataURL(props.messageObject.data.file);\n      }\n      img.onload = function () {\n        return resolve(img.src);\n      };\n    });\n  }, [props.messageObject]);\n  _react[\"default\"].useEffect(function () {\n    if (props.imageURL && props.imageURL.length) {\n      setImageURL(props.imageURL);\n    } else if (props.messageObject) {\n      var thumbnailGenerationExtensionData = (0, _Shared.getExtensionsData)(props.messageObject, _Shared.MetadataConstants.extensions.thumbnailGeneration);\n      if (thumbnailGenerationExtensionData && !thumbnailGenerationExtensionData.hasOwnProperty(\"error\")) {\n        var imageToDownload = pickImage(thumbnailGenerationExtensionData);\n        downloadImage(imageToDownload).then(function (response) {\n          var img = new Image();\n          img.src = imageToDownload;\n          img.onload = function () {\n            return setImageURL(img.src);\n          };\n        })[\"catch\"](function (error) {\n          _.CometChatMessageEvents.emit(_.CometChatMessageEvents.onMessageError, error);\n        });\n      } else {\n        setMessageImageUrl().then(function (imageUrl) {\n          if (imageUrl !== imageURL) {\n            setImageURL(imageUrl);\n          }\n        });\n      }\n    }\n\n    /**image moderation extension */\n    var imageModeration = (0, _Shared.getExtensionsData)(props === null || props === void 0 ? void 0 : props.messageObject, _Shared.ExtensionConstants.imageModeration);\n    if ((imageModeration === null || imageModeration === void 0 ? void 0 : imageModeration[\"unsafe\"]) === \"yes\") {\n      setUnsafe(true);\n    } else {\n      setUnsafe(false);\n    }\n  }, [props, imageURL, props.imageURL, props.messageObject, setImageURL, setMessageImageUrl]);\n};\nexports.Hooks = Hooks;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}